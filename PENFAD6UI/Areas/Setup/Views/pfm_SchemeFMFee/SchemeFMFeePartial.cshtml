
@using PENFAD6DAL.Repository.Setup.PfmSetup

@model IEnumerable<pfm_SchemeFeeRepo>

@{
    var SchemeRepo = new pfm_VestingRuleRepo();
    var FeeRepo = new pfm_FeesRepo();
    var fundmanagerrepo = new pfm_FundManagerRepo();
    var x = Html.X();
}

<script>
        var beforeMenu = function (pnl, tab, menu) {
            menu.items.get(0).setText(tab.title);

            var item = menu.getComponent(5),
                lastTab = pnl.items.get(pnl.items.getCount() - 1);

            if (tab.id == "customMenuTab") {
                item.show();

                if (lastTab.isTabMenuVisible()) {
                    item.setText("Hide Menu for last Tab");
                    item.handler = function () {
                        lastTab.hideTabMenu();
                    };
                } else {
                    item.setText("Show Menu for last Tab");
                    item.handler = function () {
                        lastTab.showTabMenu();
                    };
                }
            } else {
                item.hide();
            }
        };
</script>

@(x.FormPanel()

                       .ID("frmsetupSFFM")
                        .Title("Fund Manager Fee Setup")
                        .Frame(true)
                        .Closable(true)
                        .AutoScroll(true)
                        .MarginSpec("0 0 0 0")
                        .Width(1400)
                        .Height(1200)
                        .FieldDefaults(fd =>
                        {
                            fd.LabelAlign = LabelAlign.Top;
                            fd.MsgTarget = MessageTarget.Side;
                        })
                        .Items(


            x.FieldSet()
            .Height(1000)
             .Layout(LayoutType.Column)
            .Width(1400)
            .Frame(true)
            .AutoScroll(true)
            .MarginSpec("10 0 0 10")
            .Items(

                    x.GridPanel()
                            .ID("schemeFeeFMGrid")
                            .Title("View Fund Manager Fee List")
                            .Frame(true)
                            .Width(800)
                            .MarginSpec("10 0 0 10")
                            .Height(880)
                            .Plugins(
                             x.FilterHeader())
                            .Store(
                                x.Store()
                                    .AutoLoad(true)
                                    .ID("schemeFeeFMStore")
                            //  .DataSource(Model)
                            .Model(
                                x.Model()
                                    .Fields(
                                        x.ModelField().Name("Scheme_fm_Fee_Id").Type(ModelFieldType.String),
                                        x.ModelField().Name("Fund_Manager_ID").Type(ModelFieldType.String),
                                        x.ModelField().Name("Fund_Manager").Type(ModelFieldType.String),
                                        x.ModelField().Name("Scheme_Id").Type(ModelFieldType.String),
                                        x.ModelField().Name("Scheme_Name").Type(ModelFieldType.String),
                                        x.ModelField().Name("Fee_Id").Type(ModelFieldType.String),
                                        x.ModelField().Name("Fee_Description").Type(ModelFieldType.String),
                                        x.ModelField().Name("Flat_Or_Rate").Type(ModelFieldType.String),
                                        x.ModelField().Name("Flat_Or_Rate_Value").Type(ModelFieldType.Float),
                                        x.ModelField().Name("First_Accrual_Date").Type(ModelFieldType.Date),
                                        x.ModelField().Name("Next_Accrual_Date").Type(ModelFieldType.Date),
                                        x.ModelField().Name("Accrual_Frequency").Type(ModelFieldType.String),
                                        x.ModelField().Name("First_Apply_Date").Type(ModelFieldType.Date),
                                        x.ModelField().Name("Next_Apply_Date").Type(ModelFieldType.Date),
                                        x.ModelField().Name("Apply_Frequency").Type(ModelFieldType.String),
                                        x.ModelField().Name("Auth_Status").Type(ModelFieldType.String),
                                        x.ModelField().Name("Scheme_Fee_Status").Type(ModelFieldType.String)

                                        )
                            )
                            .ServerProxy(
                                   Html.X().AjaxProxy()
                                   .Url(Url.Action("Read"))
                                  )

                            .PageSize(15)
                    )
                    .Refresh()
                    .BottomBar(
                        Html.X().PagingToolbar()
                    )
                    .Listeners(l => l.SelectionChange.Handler = "if (selected[0]) { App.frmsetupSFFM.getForm().loadRecord(selected[0]); }")
                    .ColumnModel(x.Column().DataIndex("Scheme_fm_Fee_Id").Text("FEE ID").Width(100))
                    .ColumnModel(x.Column().DataIndex("Fund_Manager_ID").Text("FUND MANAGER ID").Width(0))
                     .ColumnModel(x.Column().DataIndex("Fund_Manager").Text("FUND MANAGER ID").Width(200))
                    .ColumnModel(x.Column().DataIndex("Scheme_Name").Text("SCHEME").Width(200))
                    .ColumnModel(x.Column().DataIndex("Fee_Description").Text("FEE DESCRIPTION").Width(200))
                    .ColumnModel(x.Column().DataIndex("Flat_Or_Rate").Text("TYPE").Width(80))
                    .ColumnModel(x.Column().DataIndex("Flat_Or_Rate_Value").Text("VALUE").Width(100))
                    .ColumnModel(x.Column().DataIndex("First_Accrual_Date").Text("FIRST ACCRUAL DATE").Width(0))
                    .ColumnModel(x.Column().DataIndex("Next_Accrual_Date").Text("NEXT ACCRUAL DATE").Width(0))
                    .ColumnModel(x.Column().DataIndex("Accrual_Frequency").Text("ACCRUAL FREQUENCY").Width(0))
                    .ColumnModel(x.Column().DataIndex("First_Apply_Date").Text("FIRST APPLY DATE").Width(0))
                    .ColumnModel(x.Column().DataIndex("Next_Apply_Date").Text("NEXT APPLY DATE").Width(0))
                    .ColumnModel(x.Column().DataIndex("Apply_Frequency").Text("APPLY FREQUENCY").Width(0))
                    .ColumnModel(x.Column().DataIndex("Auth_Status").Text("AUTH STATUS").Width(100))
                    .ColumnModel(x.Column().DataIndex("Scheme_Fee_Status").Text("SCHEME FEE STATUS").Width(100))
                    ,

            x.FieldSet()
                .Title("Fund Manager Fee Details")
                .AutoScroll(true)
                 .Width(500)
                 .Height(880)
                .Items(
                    x.FormPanel()
                            .ID("schemeFeeFM")
                            .MarginSpec("20 0 0 20")

                            .FieldDefaults(fd =>
                            {
                                fd.LabelAlign = LabelAlign.Top;
                                fd.MsgTarget = MessageTarget.Side;
                            })
                            .Items
                            (

                                   x.Hidden().Name("Scheme_fm_Fee_Id"),
                                   x.Hidden().Name("Scheme_Fee_Status"),
                                   x.Hidden().Name("Auth_Status"),

                                x.ComboBox().Name("Scheme_Id").ID("FM_Scheme_Id")
                                .FieldLabel("Scheme")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .Editable(false)
                                .QueryMode(DataLoadMode.Local)
                                .TriggerAction(TriggerAction.All)
                                .EmptyText("Select a Scheme")
                                .BlankText("Scheme is required.").Items(SchemeRepo.GetSchemeList().Select(d => new ListItem(d.Scheme_Name, d.Scheme_Id))),


                                 x.ComboBox().Name("Fund_Manager_ID").ID("FM_Fund_Manager_ID")
                                 .FieldLabel("Fund Manager")
                                 .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                 .AllowBlank(false)
                                 .Editable(false)
                                 .QueryMode(DataLoadMode.Local)
                                 .TriggerAction(TriggerAction.All)
                                 .EmptyText("Select Fund Manager")
                                 .BlankText("Fund Manager is required.").Items(fundmanagerrepo.GetFundmanagerList().Select(d => new ListItem(d.Fund_Manager, d.Fund_Manager_Id))),

                                 x.ComboBox().Name("Fee_Id").ID("FM_Fee_Id")
                                 .FieldLabel("Fee")
                                 .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                 .AllowBlank(false)
                                 .Editable(false)
                                 //.Text("PENSION FUND MANAGER")
                                 .QueryMode(DataLoadMode.Local)
                                 .TriggerAction(TriggerAction.All)
                                 .EmptyText("Select a Fee")
                                 .BlankText("Fee is required.").Items(FeeRepo.GetFeesListFM().Select(d => new ListItem(d.Fee_Description, d.Fee_Id))),

                                x.ComboBox().Name("Flat_Or_Rate")
                                .FieldLabel("Fee Type")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .Editable(false)
                                .QueryMode(DataLoadMode.Local)
                                .TriggerAction(TriggerAction.All)
                                .EmptyText("Select a Fee Type")
                                .BlankText("Fee Type is required.").Items("FLAT", "RATE"),

                                x.NumberField().Name("Flat_Or_Rate_Value")
                                .FieldLabel("Annual Rate/Value")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .BlankText("Value is required."),

                                  x.ComboBox().Name("Accrual_Frequency").ID("FM_Acc_Frequency")
                                .FieldLabel("Accrual Frequency")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .Editable(false)
                                .QueryMode(DataLoadMode.Local)
                                .TriggerAction(TriggerAction.All)
                                .EmptyText("Select Accrual Frequency")
                                .BlankText("Accrual Frequency is required.").Items("DAILY", "MONTHLY", "QUARTERLY"),

                                x.DateField().Name("First_Accrual_Date")
                                .FieldLabel("First Accrual Date")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .BlankText("First Accrual Date is required."),


                                x.DateField().Name("Next_Accrual_Date")
                                 .FieldLabel("Next Accrual Date").ReadOnly(true)
                                 .Text("01 - 01 - 2000")
                                 .MarginSpec("0 20 8 0").TabIndex(5).Width(400),

                                x.ComboBox().Name("Apply_Frequency").ID("FM_A_Frequency")
                                .FieldLabel("Apply Frequency")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .Editable(false)
                                .QueryMode(DataLoadMode.Local)
                                .TriggerAction(TriggerAction.All)
                                .EmptyText("Select Apply Frequency")
                                .BlankText("Apply Frequency is required.").Items("MONTHLY", "QUARTERLY"),

                                x.DateField().Name("First_Apply_Date")
                                .FieldLabel("First Apply Date")
                                .MarginSpec("0 20 8 0").TabIndex(5).Width(400)
                                .AllowBlank(false)
                                .BlankText("First Apply Date is required."),

                                 x.DateField().Name("Next_Apply_Date").ReadOnly(true)
                                 .FieldLabel("Next Apply Date")
                                 .Text("01 - 01 - 2000")
                                 .MarginSpec("0 20 8 0").TabIndex(5).Width(400) ,

                               x.Button()
                                .Text("Save")
                                .Width(100)
                                .Icon(Icon.Add)
                                .DirectEvents(de =>
                                {
                                    de.Click.Confirmation.ConfirmRequest = true;
                                    de.Click.Confirmation.Title = "Add Record";
                                    de.Click.Confirmation.Message = "Create Fund Manager Fee?";
                                    de.Click.Url = Url.Action("SaveRecord");
                                }).MarginSpec("20 10 0 0"),

                            x.Button()
                                .Text("Delete")
                                .Width(100)
                                .Icon(Icon.Delete)
                                .DirectEvents(de =>
                                {
                                    de.Click.Confirmation.ConfirmRequest = true;
                                    de.Click.Confirmation.Title = "Delete Record";
                                    de.Click.Confirmation.Message = "Delete Fund Manager Fee?";
                                    de.Click.Url = Url.Action("DeleteRecord");
                                }).MarginSpec("20 10 0 0"),

                                x.Button()
                                .Text("Clear")
                                .Width(100)
                                .Icon(Icon.ArrowRefresh)
                                .OnClientClick("this.up('form').getForm().reset();")
                                .MarginSpec("20 10 0 0")
                                )

                        )

                )
        )

)

































