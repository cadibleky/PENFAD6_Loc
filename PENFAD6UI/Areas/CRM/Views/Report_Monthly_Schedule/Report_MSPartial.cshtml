@using PENFAD6DAL.Repository.Setup.PfmSetup
@using PENFAD6DAL.Repository.Remittance.Contribution

@{
	var schemeRepo = new pfm_SchemeRepo();
	var tRepo = new Remit_Contribution_Upload_LogRepo();

	var x = Html.X();

}

<script>
	var onSuccess = function (grid, data) {
		grid.show();
		grid.getStore().loadData(data);
	};
</script>

@(Html.X().FormPanel()
				   .ID("Report_MonthlySchedulePartial_frm_main")
				   .Title("Employer Schedule")
				   .Closable(true)
				   .Layout(LayoutType.Border)
				   .Frame(true)
				   .AutoScroll(true)
				   .FieldDefaults(fd =>
				   {
					   fd.LabelAlign = LabelAlign.Top;
					   fd.MsgTarget = MessageTarget.Side;
				   })
				   .MarginSpec("10 0 0 10")
				   .Items(Html.X().FormPanel()
								.ID("Report_MonthlySchedulePartial_frm_left_Panel")
								.Title("Employer Schedule")
								.Region(Region.West)
								.Split(true)
								.Collapsible(true)
								.AutoScroll(true)
								.Width(350)
								.MinWidth(150)
								.MaxWidth(420)
								.Items(Html.X().FormPanel()
												.ID("Report_MonthlySchedulePartial_frm_txtFields")
												.Border(true)
												.AutoScroll(true)
												.Width(410)
												.Height(320)
												.Layout(LayoutType.Column)
												.Items(
														x.Button().Text("Get Employer Account").Width(200).MarginSpec("2 0 0 3")
														.Handler("App.Report_MonthlySchedulePartial_frm_employeePopup.show(this);"),
														x.TextField().ID("Report_MonthlySchedulePartial_txtESId").Name("ES_Id").FieldLabel("Employer Account No.").Width(320).ReadOnly(false).MarginSpec("2 2 0 5")
														.Listeners(ls =>
																					   ls.Change.Handler = "App.wPay_Schedulemonth.clearValue(); App.wPay_Schedulemonth.getStore().load();"),

														x.TextField().ReadOnly(true).Name("Employer_Name").FieldLabel("Employer Name").Width(320).MarginSpec("2 2 0 5"),
														x.TextField().ReadOnly(true).Name("Scheme_Name").FieldLabel("Scheme").Width(320).MarginSpec("2 2 0 5"),

													x.ComboBox().Name("con_month").ID("wPay_Schedulemonth")
																	.FieldLabel("Contribution Month")
																	.Width(320)
																	.Editable(false)
																	.TypeAhead(true)
																	.QueryMode(DataLoadMode.Local)
																	.ForceSelection(true)
																	.TriggerAction(TriggerAction.All)
																	.DisplayField("name")
																	.ValueField("id")
																	.BlankText("Contribution Month is required.")
																	.EmptyText("No Contribution Month Available...")
																	.ValueNotFoundText("No Contribution Month Available...").MarginSpec("15 0 0 10")
																	//.Listeners(ls =>
																	//		   ls.Change.Handler = "App.wPay_GLBalance.clearValue(); App.wPay_GLBalance.getStore().load();")

																	.Store(Html.X().Store()
																		.AutoLoad(false)
																		.Model(Html.X().Model()
																			.IDProperty("Schedulelist_GLB_gId")
																			.Fields(
																				new ModelField("id", ModelFieldType.String) { Mapping = "Schedulelist_GLB_gId" },
																				new ModelField("name", ModelFieldType.String) { Mapping = "conName" }
																			)
																		)
																		.Proxy(Html.X().AjaxProxy()
																			.Url(Url.Action("GetGLAB"))
																			.Reader(Html.X().JsonReader().RootProperty("data"))
																		)
																		.Parameters(ps =>
																			ps.Add(new StoreParameter("ES_Id", "App.Report_MonthlySchedulePartial_txtESId.getValue()", ParameterMode.Raw))
																		)
																		.Listeners(ls =>
																						ls.Load.Handler = @"var combo = App.wPay_Schedulemonth; 
                                                                                                            combo.setValue(records[0].get(combo.valueField));"

																		)

																   )



														),// end items


									Html.X().TreePanel()
											.ID("Report_MonthlySchedulePartial_frm_left_treepanel_menu")
											//.Border(true)
											.MarginSpec("5 0 10 10")
											.RootVisible(false)
											.Store(
													Html.X().TreeStore()
														.Proxy(Html.X().AjaxProxy().Url(Url.Action("GetChildren")))
													 )
											.Root(Html.X().Node().NodeID("employee_rep_0").Text("Root"))
											.ViewConfig(Html.X().TreeView().LoadMask(false))
											/////////.Listeners(l => l.Select.Handler = "alert(App.Report_EmployeePartial_frm_left_treepanel_menu.getSelectionModel().getSelectedNode().id);")
											.DirectEvents(de =>
											{
												de.ItemClick.Url = Url.Action("Load_Employee_Report_IFrame");
												de.ItemClick.ExtraParams.Add(new Parameter("containerId", "Report_MonthlySchedulePartial_panel_right_center_content"));

												de.ItemClick.ExtraParams.Add(new StoreParameter("Scheme_Id", "App.Report_MonthlySchedulePartial_txtESId.getValue()", ParameterMode.Raw));

												de.ItemClick.ExtraParams.Add(new StoreParameter("tree_node_id", "record.get('id')", ParameterMode.Raw));

											})
						 ),// end


		///center region starts
		Html.X().Panel()
								.ID("Report_MonthlySchedulePartial_panel_right_center_content")
								//.Title("GL Journal Trans. Posting")
								.Region(Region.Center)
								.Split(true)
								.AutoScroll(true)
								.Loader(Html.X().ComponentLoader()
												.Url(Url.Action("Load_Employee_Report"))
												.Mode(LoadMode.Frame)
												.LoadMask(lm => lm.ShowMask = true)
											)


		)// end Report_EmployeePartial_frm_left_Panel




		//windows for employees
		.Items(Html.X().Window()
			.ID("Report_MonthlySchedulePartial_frm_employeePopup")
			.Title("Scheme List")
			.Width(1300)
			.Height(700)
			.AutoScroll(true)
			.Hidden(true)
			.Modal(true)
			.MarginSpec("10 10 0 10")
			.AutoRender(false)
			.Collapsible(true)
			.Maximizable(true)
			.Loader(Html.X().ComponentLoader()
						.Mode(LoadMode.Frame)
						.LoadMask(lm => lm.ShowMask = true)
					)
			.Items(x.FieldSet()
						.Title("Search")
						.Width(400)
						.Height(100)
						.Items(
								x.Panel()
									.Layout(LayoutType.HBox)
									.Items(

											x.Button()
													.Text("View Schemes")
													.Icon(Icon.ArrowRefresh)
													.MarginSpec("30 0 20 0")
													.Width(160)
													.DirectEvents(de =>
													{
														de.Click.Url = Url.Action("Get_EmployersScheme");
														de.Click.Success = "onSuccess(App.Repoert_MonthlySchedule_SFGrid, result.data);";
														//de.Click.ExtraParams.Add(new Parameter("ES_Id", "App.Report_MonthlySchedulePartial_txtESId.getValue()", ParameterMode.Raw));

													})
											  ),

										x.GridPanel()
										.ID("Repoert_MonthlySchedule_SFGrid")
										.Frame(true)
										.WidthSpec("Auto")
										.HeightSpec("Auto")
										.MarginSpec("10 0 0 10")
										.Plugins(
										x.FilterHeader()
											)
										.Store(
										x.Store()
										.AutoLoad(true)
										.ID("MSStore")
										// .DataSource(Model)
										.Model(
										x.Model()
										.Fields(
											new ModelField("Employer_Name", ModelFieldType.String),
															new ModelField("Scheme_Name", ModelFieldType.String),
															new ModelField("Employer_Id", ModelFieldType.String),
															new ModelField("Scheme_Id", ModelFieldType.String),
															new ModelField("ES_Id", ModelFieldType.String),
															new ModelField("DeadLine_Date", ModelFieldType.Date)

												)
												)
										.ServerProxy(
										x.AjaxProxy()
												//.Url(Url.Action("ReadSF"))
												.Url(Url.Action("Get_EmployersScheme", "Report_Monthly_Schedule"))
																  .Reader(Html.X().JsonReader().RootProperty("data")))
															//.Parameters(ps =>
															//ps.Add(new StoreParameter("ES_Id", "App.Report_MonthlySchedulePartial_txtESId.getValue()", ParameterMode.Raw)
															//)
															//)

										.PageSize(10)
												)
										.BottomBar(
										x.PagingToolbar()
												 )
						.Refresh()
						.Listeners(l => l.SelectionChange.Handler = "if (selected[0]) { App.Report_MonthlySchedulePartial_frm_txtFields.getForm().loadRecord(selected[0]); App.Report_MonthlySchedulePartial_frm_employeePopup.hide(); }")
						.ColumnModel(x.Column().Text("Employer Name").DataIndex("Employer_Name").Width(350))
						.ColumnModel(x.Column().Text("Scheme Name").DataIndex("Scheme_Name").Width(250))
						.ColumnModel(x.Column().Text("Scheme Id").DataIndex("Scheme_Id").Width(100))
						.ColumnModel(x.Column().Text("Employer Acct.No.").DataIndex("ES_Id").Width(100))
						.ColumnModel(x.Column().Text("DeadLine Date").DataIndex("DeadLine_Date").Width(100))

																	   )

								)//end tax grid panel



		)// end CASA_IC_Product_Partial_win_search_tax_gls



// end main
)